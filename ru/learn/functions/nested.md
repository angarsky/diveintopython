> [!NOTE]
> Вы можете прочитать эту статью на сайте: https://diveintopython.org/ru/learn/functions/nested

Вложенные функции являются **мощным инструментом**, доступным в программировании на Python, который позволяет определять функции внутри других функций. Такая концепция вложения одной функции в другую может создать более организованный и управляемый код. С помощью вложенных функций код становится легче читаемым и также более эффективным. В этой статье мы более подробно рассмотрим, что такое вложенные функции и почему они используются в Python.

## Понимание Вложенных Функций в Python

Вложенные функции в Python относятся к созданию функций внутри другой функции. Другими словами, функция может быть определена внутри другой функции, и она может получать доступ к переменным, объявленным в своей внешней функции.

Вложенные функции полезны в ситуациях, когда нам нужно определить вспомогательную функцию, которая необходима только в рамках внешней функции. Вложенные функции улучшают читаемость и помогают модуляризировать код.

### Два Примера Вложенных Функций в Python

```python
def outer_function(x):
    def inner_function(y):
        return x + y
    return inner_function

add_five = outer_function(5)
print(add_five(3)) # Output: 8
```

В этом примере мы определяем две функции: `outer_function` и `inner_function`. `outer_function` принимает один аргумент `x` и возвращает `inner_function`. В свою очередь, `inner_function` принимает один аргумент `y` и возвращает сумму `x` и `y`.

Мы присваиваем вывод `outer_function(5)` переменной `add_five`, которая становится функцией, добавляющей `5` к её аргументу. Когда мы вызываем `add_five(3)`, мы получаем `8` в результате.

```python
def outer_function():
    x = 1
    def inner_function():
        y = 2
        return x + y
    return inner_function()

print(outer_function()) # Output: 3
```

В этом примере мы определяем `outer_function`, которая инициализирует переменную `x` значением 1 и возвращает результат `inner_function`. `Inner_function` инициализирует переменную `y` значением `2` и возвращает сумму `x` и `y`.

Когда мы вызываем `outer_function()`, мы получаем `3` в качестве результата, что является суммой `x` и `y`. `Inner_function` вызывается в области видимости `outer_function`, и имеет доступ к переменной `x`, объявленной в `outer_function`.

## Преимущества Использования Вложенных Функций в Python

Вложенные функции в коде Python предоставляют ряд преимуществ, позволяя разработчикам создавать более надежную и адаптивную структуру программирования, повышать читаемость кода и создавать модульный код, который проще поддерживать.

### Инкапсуляция и Модульность

Основное преимущество вложенных функций заключается в их способности определять вспомогательные функции в пределах области видимости конкретной функции. Таким образом, это предотвращает загромождение глобального пространства имен и способствует организации кода. Рассмотрим следующий пример:

```python
def double_odd_numbers(numbers):
    def is_odd(num):
        return num % 2 != 0
    
    def double(num):
        return num * 2
    
    return [double(num) for num in numbers if is_odd(num)]
```

В этом случае `double_odd_numbers` включает в себя функции `is_odd` и `double`, упрощая понимание, поскольку эти функции используются исключительно в контексте основной функции.

### Создание Замыканий

Еще одно заметное преимущество вложенных функций — их способность генерировать замыкания. Это позволяет вложенным функциям получать доступ к переменным их окружающей функции и управлять ими. Например:

```python
def power_function(base):
    def exponent_power(exponent):
        result = 1
        for _ in range(exponent):
            result *= base
        return result
    
    return exponent_power

square = power_function(2)
cube = power_function(3)

print(square(3))  # Output: 8
print(cube(2))    # Output: 9
```

В этом сценарии, `power_function` создаёт новую функцию, `exponent_power`, способную вычислять степень основания, возведённого в данную степень. Используя эту вложенную структуру, функции как `square` и `cube` получают доступ к переменной основания из окружающей функции, упрощая создание новых функций с разными базовыми значениями.

Используя вложенные функции, разработчики Python могут улучшить модульность кода, читаемость и использовать мощные функции замыкания для создания более универсальных и эффективных структур кода.

## Создание Вложенных Функций в Python

Вложенные функции в Python относятся к процессу создания функции внутри другой функции. Этот процесс позволяет лучше организовывать и улучшать читаемость кода. Для создания вложенной функции в Python следуйте этим шагам:

1. **Создайте** внешнюю функцию.
2. **Определите** внутреннюю функцию внутри внешней функции.
3. **Вызовите** внутреннюю функцию внутри внешней функции или верните её.

В заключение, создание вложенных функций в Python - это полезная техника для организации и оптимизации кода. Это позволяет улучшить читаемость и может упростить сложные процессы.

## Примеры Вложенных Функций Python в Реальных Приложениях

Вложенные функции - это функции **внутри других функций**. Эти функции особенно полезны в программировании. Они могут использоваться в реальных приложениях на Python. Например, вложенная функция может определить функцию, которая вызывает другую функцию. Или, вложенная функция может определить функцию, использующую ранее определённую функцию. Кроме того, вложенная функция может обеспечивать локальную область видимости.

```python
def parent_function(x):
    def child_function(y):
        return y * 2
    return x + child_function(x)

print(parent_function(5))
```

В этом примере, `child_function` является вложенной функцией. Она определена внутри `parent_function`. `parent_function` принимает параметр `x`. Затем она использует `child_function` для удвоения `x`. В конце концов, она возвращает сумму `x` и `child_function(x)`. Когда мы запускаем `parent_function(5)`, мы получаем 15 в результате.

```python
def adder(a):
    def inner(x):
        return x + a
    return inner

x = adder(3)
y = adder(5)
print(x(5))
print(y(5))
```

В этом примере, `inner` является вложенной функцией. Она определена внутри `adder`. `adder` принимает параметр a. `adder` возвращает `inner`. `inner` принимает параметр `x`. Она возвращает сумму `x` и `a`. Когда мы вызываем `adder(3)`, мы получаем `inner`. Мы сохраняем `inner` как `x`. То же самое относится к `adder(5)`, который мы сохраняем как `y`. Когда мы вызываем `x(5)`, мы получаем 8 в качестве результата. Когда мы вызываем `y(5)`, мы получаем 10 в качестве результата.

```python
def exponential(x):
    def square(y):
        return y * y
    return square(x) * square(x)

print(exponential(2))
```

В этом примере, `square` является вложенной функцией. Она определена внутри `exponential`. `exponential` принимает параметр `x`. `exponential` возвращает квадрат `x`, возведенный в четвертую степень. `square` принимает параметр `y`. Она возвращает квадрат `y`. Когда мы запускаем `exponential(2)`, мы получаем 16 в результате.
  
## Лучшие Практики Использования Вложенных Функций в Python  

Вложенные функции относятся к определению функции внутри другой функции в Python. Это может быть полезным для организации кода и инкапсуляции. Лучшие практики использования вложенных функций включают избегание чрезмерной вложенности, обеспечение четкой и конкретной цели для каждой функции, и использование подходящих областей переменных.

Для использования вложенных функций в Python определите внешнюю функцию, а затем определите внутреннюю функцию внутри нее. Внутренняя функция имеет доступ к переменным внутри внешней функции, но не наоборот. Вот два примера:

```python
# Example 1: Power function using nested functions
def power_function(num):
    def inner_power(power):
        return num ** power
    return inner_power

# Example usage
square_function = power_function(2)
cube_function = power_function(3)
print(square_function(5))  # Output: 32
print(cube_function(5))  # Output: 243
```

```python
# Example 2: Functions in a loop
def generate_functions():
    functions = []
    for i in range(5):
        def inner_function(num):
            return num + i
        functions.append(inner_function)
    return functions

# Example usage
functions_list = generate_functions()
for j, f in enumerate(functions_list):
    print(f(j))  # Output: 4 5 6 7 8
```

В первом примере создается функция степени с использованием вложенных функций. Внешняя функция принимает число и возвращает внутреннюю функцию, которая вычисляет степень этого числа. Внутренняя функция определена в области видимости внешней функции, что позволяет ей получить доступ к параметру `num` и вычислить степень.

Во втором примере список функций генерируется с использованием цикла и вложенных функций. Внутренняя функция определена внутри цикла, что дает ей доступ к переменной цикла `i`. Полученный список функций затем может быть использован для выполнения вычислений с различными значениями `i`.

## Различия Между Вложенными Функциями и Анонимными Функциями в Python

Вложенные функции - это функции, которые определены внутри другой функции. Эти функции доступны только из внешней, содержащей их функции. С другой стороны, анонимные функции - это функции без имен, которые определяются с использованием ключевого слова lambda. Эти функции могут быть определены в любом месте программы и могут быть переданы в качестве аргументов другим функциям.

### Вложенная Функция

```python
def outer_func(x):
   def inner_func(y):
       return x*y
   return inner_func

result = outer_func(5)
print(result(7))  # Output: 35
```

В этом примере функция `inner_func` определена внутри `outer_func`, что делает её вложенной функцией. Затем мы возвращаем `inner_func` в качестве результата вызова `outer_func`. Переменной `result` присваивается внутренняя функция со значением `x`, равным `5`. Затем мы вызываем `result` с `y`, равным `7`, чтобы получить результат `35`.

### Анонимная Функция

```python
list_nums = [1, 2, 3, 4, 5]
new_list = list(map(lambda x: x*2, list_nums))
print(new_list)  # Output: [2, 4, 6, 8, 10]
```

В этом примере мы используем анонимную функцию, определенную с помощью ключевого слова `lambda` и переданную в качестве аргумента функции `map`. Эта функция умножает каждый элемент `list_nums` на `2` и возвращает новый список с отображенными результатами, сохраненными в `new_list`.
  
## Распространенные Ошибки, Которых Следует Избегать при Использовании Вложенных Функций в Программировании на Python  

Чтобы избежать распространенных ошибок при использовании вложенных функций в программировании на Python, важно убедиться, что имена функций и переменных **не повторяются** внутри вложенной функции и ее родительской функции, так как это может вызвать путаницу и ошибки.

Другие распространенные ошибки, которых следует избегать, включают неправильный вызов функции внутри другой функции и неправильное использование циклов во вложенных функциях. Кроме того, требуется осторожность при использовании техник функционального программирования и степенных функций во вложенных функциях.

Например, следующий код иллюстрирует распространенную ошибку, когда переменная определена как в родительской, так и во вложенной функции:

```python
def parent_func():
    num = 2
    def nested_func():
        num = num * 2 # This will raise an UnboundLocalError when the function will be called
        return num
    return nested_func()
```
